/*
 * This source file was generated by the Gradle 'init' task
 */
package lab7;
import java.io.File;
import java.io.FileNotFoundException;
import java.util.HashMap;
import java.util.Map;
import java.util.PriorityQueue;
import java.util.Scanner;

import heap.Heap;

public class Huffman {

    public static void main(String[] args) throws FileNotFoundException{
        Heap heap = new Heap();
        Map<Character, Integer> table = new HashMap<>();
        File file = new File(args[0]);
        if(file == null){
            throw new FileNotFoundException();
        }
        Scanner sc = new Scanner(file);
        try {
            sc = new Scanner(file);
        } catch (FileNotFoundException e) {
            System.out.println("File not Found");
        }

        countFrequencies(sc, table);

        Node tree = buildTree(table);

        System.out.println(tree.right.right.letter);
    }

    public static void countFrequencies(Scanner sc, Map<Character, Integer> table){
        String line;
        while(sc.hasNextLine()){
            line = sc.nextLine();
            for(int i = 0; i < line.length(); i++){
                if(!table.containsKey(line.charAt(i))){
                    table.put(line.charAt(i), 1);
                    System.out.println(line.charAt(i) + "" + table.get((Character)line.charAt(i)));
                }
                else{
                    System.out.println(table.get(line.charAt(i)));
                    int e = (int)(table.get(line.charAt(i))) + 1;
                    table.put(line.charAt(i), e);
                }
            }

        }
    }

    public static Node buildTree(Map<Character,Integer> map) { //table is a placeholder
        PriorityQueue<Node> q = new PriorityQueue<>();
        for (Map.Entry<Character, Integer> entry : map.entrySet()) {
            q.add(new Node(entry.getValue(), entry.getKey()));
        }

        while(q.size() != 1){
            Node left = q.poll();
            Node right = q.poll();
            Node tip = new Node(left.frequency + right.frequency, right.letterCount+left.letterCount);
            if(left.compareTo(right) == 0){
                if(left.letter != null || right.letter != null){
                    if(left.letterCount <= right.letterCount){
                        tip.setLeft(left);
                        tip.setRight(right);
                    }else{
                        tip.setLeft(right);
                        tip.setRight(left);
                    }
                }
                else if(left.letter.compareTo(right.letter) < 0){
                    tip.setLeft(left);
                    tip.setRight(right);
                }
                else{
                    tip.setLeft(right);
                    tip.setRight(left);
                }
            }
            else if(left.compareTo(right) == 1){
                tip.setLeft(right);
                tip.setRight(left);
            }
            else{
                tip.setLeft(left);
                tip.setRight(right);
            }
            q.add(tip);
        }
        return q.poll();
    }

}
